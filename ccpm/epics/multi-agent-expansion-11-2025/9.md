---
name: Implement Multi-Worktree Per Agent
status: open
created: 2025-11-04T04:19:31Z
updated: 2025-11-04T04:24:55Z
github: https://github.com/foozlevazquez/ccpm/issues/9
depends_on: [6, 7]
parallel: false
conflicts_with: []
---

# Task: Implement Multi-Worktree Per Agent

## Description
Enable each agent to work in its own git worktree branch for complete isolation. Implement coordinator pattern to merge agent branches when work completes.

## Acceptance Criteria
- [ ] Each agent creates own worktree: `../epic-{name}-agent-{id}`
- [ ] Agent branches: `epic/{name}/agent-{id}`
- [ ] Coordinator merges agent branches to main epic branch
- [ ] Conflict detection before merge
- [ ] Automatic cleanup of agent worktrees on completion
- [ ] Command to merge agent branches: `/pm:epic-merge-agents`

## Technical Details
- Modify epic-start to create per-agent worktree
- Worktree naming: `../epic-{name}-agent-{uuid}`
- Branch naming: `epic/{name}/agent-{uuid}`
- Coordinator workflow:
  1. Check all agent branches for commits
  2. Merge each to epic/{name} branch
  3. Detect conflicts and report
  4. Clean up agent branches after merge
- Update agent registry with worktree path
- Implement merge conflict reporting

## Files Affected
- `ccpm/commands/pm/epic-start.md` (modify)
- `ccpm/commands/pm/epic-merge-agents.md` (new)
- `ccpm/scripts/pm/epic-merge-agents.sh` (new)
- `ccpm/rules/worktree-operations.md` (update)

## Dependencies
- [ ] Task 005 (agent registry)
- [ ] Task 006 (work stream ownership)

## Effort Estimate
- Size: L
- Hours: 6-8
- Parallel: false

## Definition of Done
- [ ] Per-agent worktrees working
- [ ] Coordinator merge tested
- [ ] Conflict detection verified
- [ ] Cleanup on completion working
- [ ] Documentation updated
