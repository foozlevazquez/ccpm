---
name: Implement Agent Registry System
status: open
created: 2025-11-04T04:19:31Z
updated: 2025-11-04T04:24:55Z
github: https://github.com/foozlevazquez/ccpm/issues/6
depends_on: [3]
parallel: true
conflicts_with: []
---

# Task: Implement Agent Registry System

## Description
Create an agent registration and discovery mechanism using JSON files. Agents register on epic start, maintain heartbeats, and can discover other active agents.

## Acceptance Criteria
- [ ] Agent registration on epic/issue start
- [ ] Heartbeat mechanism with timestamp updates
- [ ] Agent status tracking (active, stale, dead)
- [ ] Work stream assignment tracking
- [ ] Agent discovery API for coordination
- [ ] Cleanup of stale agent entries
- [ ] Command to view active agents: `/pm:agents`

## Technical Details
- Registry file: `.claude/epics/{epic}/agents.json`
- Agent ID: `agent-{uuid}` generated on registration
- Registry schema:
  ```json
  {
    "agents": {
      "agent-id": {
        "started": "datetime",
        "last_heartbeat": "datetime",
        "status": "active|stale|dead",
        "work_stream": "stream-name",
        "files_locked": ["file1", "file2"],
        "commits": 0
      }
    }
  }
  ```
- Functions needed:
  - `register_agent(epic, work_stream)`
  - `heartbeat(agent_id)`
  - `unregister_agent(agent_id)`
  - `get_active_agents(epic)`
  - `cleanup_stale_agents(epic)`
- Heartbeat interval: 60 seconds
- Stale threshold: 5 minutes

## Files Affected
- `ccpm/scripts/lib/agent-registry.sh` (new)
- `ccpm/commands/pm/agents.md` (new)
- `ccpm/scripts/pm/agents.sh` (new)

## Dependencies
- [ ] Task 002 (atomic operations for JSON updates)

## Effort Estimate
- Size: M
- Hours: 5-7
- Parallel: true

## Definition of Done
- [ ] Agent registration working
- [ ] Heartbeat mechanism tested
- [ ] Stale agent cleanup verified
- [ ] `/pm:agents` command implemented
- [ ] Documentation added
