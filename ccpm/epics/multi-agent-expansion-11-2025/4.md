---
name: Add Optimistic Locking to Frontmatter
status: open
created: 2025-11-04T04:19:31Z
updated: 2025-11-04T04:24:55Z
github: https://github.com/foozlevazquez/ccpm/issues/4
depends_on: [3]
parallel: false
conflicts_with: []
---

# Task: Add Optimistic Locking to Frontmatter

## Description
Implement version-based optimistic locking for task and epic files. Add version field to frontmatter and validate before updates to detect concurrent modifications.

## Acceptance Criteria
- [ ] Version field added to all task/epic frontmatter schemas
- [ ] Version validation before frontmatter updates
- [ ] Conflict detection with clear error messages
- [ ] Automatic version increment on successful updates
- [ ] Migration script for existing files
- [ ] Retry logic with user notification on conflicts

## Technical Details
- Add `version: 1` to frontmatter template
- Before update: read current version, compare with expected
- On mismatch: report conflict with details
- On success: increment version and write
- Update these commands:
  - `epic-sync.md` - check version before updating epic
  - `issue-sync.md` - check version before updating tasks
  - `epic-decompose.md` - initialize version: 1
- Use atomic file operations from task 002

## Files Affected
- `ccpm/scripts/lib/frontmatter.sh` (extend)
- `ccpm/scripts/pm/migrate-versions.sh` (new)
- `ccpm/commands/pm/epic-sync.md` (modify)
- `ccpm/commands/pm/issue-sync.md` (modify)
- `ccpm/commands/pm/epic-decompose.md` (modify)

## Dependencies
- [ ] Task 002 (atomic file operations)

## Effort Estimate
- Size: M
- Hours: 5-7
- Parallel: false

## Definition of Done
- [ ] Version field in all templates
- [ ] Validation working in all commands
- [ ] Migration script tested
- [ ] Conflict scenarios handled gracefully
- [ ] Documentation updated
